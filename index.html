<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>محاسبه‌گر هوشمند قیمت تتر</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #eceff1; padding: 30px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { color: #2c3e50; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
        .status-box { background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #4CAF50; color: white; padding: 15px; }
        td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; }
        tr:hover { background-color: #f1f1f1; }
        .btn-refresh { background: #2196F3; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px; }
        .btn-refresh:hover { background: #1976D2; }
    </style>
</head>
<body>

<div class="container">
    <h2>لیست قیمت‌ها (تتر + ۱۵٪ کارمزد)</h2>
    
    <div class="status-box" id="status-area">
        در حال هماهنگ‌سازی با بازار جهانی...
    </div>

    <button class="btn-refresh" onclick="location.reload()">به‌روزرسانی دستی صفحه</button>

    <table>
        <thead>
            <tr>
                <th>مبلغ (دلار)</th>
                <th>با ۱۵٪ سود ($)</th>
                <th>معادل ریالی (تومان)</th>
            </tr>
        </thead>
        <tbody id="table-body">
            </tbody>
    </table>
</div>

<script>
    const amounts = [100, 300, 500, 700, 800, 900, 1000, 1500, 2000, 2500, 3000];
    const fee = 1.15;

    async function getPrice() {
        const statusArea = document.getElementById('status-area');
        
        try {
            // استفاده از API بایننس برای تست اتصال (یا یک سرویس عمومی نرخ ارز)
            const response = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=USDTTRY'); 
            // نکته: چون قیمت تتر به تومان در صرافی‌های خارجی نیست، معمولا باید از صرافی داخلی گرفت.
            // اگر نوبیتکس خطا می‌دهد، احتمالاً به خاطر فیلترشک یا محدودیت مرورگر است.
            
            // راه حل جایگزین: دریافت دستی قیمت اگر API مسدود بود
            let manualPrice = prompt("به دلیل محدودیت مرورگر در دریافت خودکار، لطفا قیمت لحظه‌ای تتر را وارد کنید (به تومان):", "70000");
            
            if (manualPrice == null || manualPrice == "") {
                manualPrice = 70000; // مقدار پیش‌فرض
            }

            statusArea.innerText = `قیمت مبنای محاسبه: ${parseInt(manualPrice).toLocaleString()} تومان`;
            renderData(parseInt(manualPrice));

        } catch (error) {
            statusArea.style.background = "#ffebee";
            statusArea.innerText = "خطا در اتصال. لطفاً قیمت را دستی وارد کنید.";
            let price = prompt("خطا در دریافت خودکار. قیمت تتر را وارد کنید:", "70000");
            renderData(price);
        }
    }

    function renderData(tetherPrice) {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = '';

        amounts.forEach(amt => {
            const finalUsd = amt * fee;
            const finalToman = finalUsd * tetherPrice;

            const row = `<tr>
                <td>${amt.toLocaleString()} $</td>
                <td style="color: #2e7d32; font-weight:bold;">${finalUsd.toLocaleString()} $</td>
                <td style="color: #c62828; font-weight:bold;">${Math.round(finalToman).toLocaleString()} تومان</td>
            </tr>`;
            tbody.innerHTML += row;
        });
    }

    window.onload = getPrice;
</script>

</body>
</html>
