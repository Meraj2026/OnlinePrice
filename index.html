<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قیمت لحظه‌ای تتر + ۱۵٪ سود</title>
    <style>
        :root { --primary: #2563eb; --secondary: #10b981; --bg: #f8fafc; }
        body { font-family: Tahoma, sans-serif; background-color: var(--bg); margin: 0; padding: 20px; color: #1e293b; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h2 { text-align: center; color: var(--primary); margin-bottom: 30px; }
        .price-card { background: linear-gradient(135deg, #2563eb, #1e40af); color: white; padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 25px; font-size: 1.2rem; }
        table { width: 100%; border-collapse: collapse; overflow: hidden; border-radius: 12px; }
        th { background-color: #f1f5f9; color: #475569; padding: 15px; font-weight: bold; }
        td { padding: 15px; text-align: center; border-bottom: 1px solid #f1f5f9; font-size: 1.05rem; }
        tr:last-child td { border-bottom: none; }
        tr:hover { background-color: #f8fafc; }
        .usd-val { font-weight: bold; color: #64748b; }
        .profit-val { font-weight: bold; color: var(--secondary); }
        .toman-val { font-weight: bold; color: #e11d48; }
        #loading { font-size: 0.9rem; opacity: 0.8; }
    </style>
</head>
<body>

<div class="container">
    <h2>لیست قیمت‌های به‌روز (تتر + ۱۵٪)</h2>
    
    <div id="price-display" class="price-card">
        <span id="loading">در حال فراخوانی قیمت از شبکه...</span>
    </div>

    <table>
        <thead>
            <tr>
                <th>مبلغ ($)</th>
                <th>با سود ۱۵٪ ($)</th>
                <th>قیمت نهایی (تومان)</th>
            </tr>
        </thead>
        <tbody id="table-body">
            </tbody>
    </table>
</div>

<script>
    const amounts = [100, 300, 500, 700, 800, 900, 1000, 1500, 2000, 2500, 3000];
    const profitRate = 1.15;

    async function getTetherPrice() {
        try {
            // استفاده از یک پروکسی رایگان برای دور زدن محدودیت CORS
            const proxyUrl = 'https://api.allorigins.win/get?url=';
            const targetUrl = encodeURIComponent('https://api.nobitex.ir/v2/orderbook/USDTIRT');
            
            const response = await fetch(proxyUrl + targetUrl);
            const data = await response.json();
            const parsedData = JSON.parse(data.contents);
            
            // دریافت آخرین قیمت و تبدیل ریال به تومان
            const priceInToman = parseInt(parsedData.lastTradePrice) / 10;
            
            document.getElementById('price-display').innerHTML = `
                قیمت لحظه‌ای تتر در بازار: 
                <strong>${priceInToman.toLocaleString()} تومان</strong>
            `;
            
            updateTable(priceInToman);
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('price-display').innerHTML = "خطا در برقراری ارتباط با صرافی. دوباره تلاش کنید.";
        }
    }

    function updateTable(tetherPrice) {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = '';

        amounts.forEach(usd => {
            const usdWithProfit = usd * profitRate;
            const finalToman = usdWithProfit * tetherPrice;

            const row = `
                <tr>
                    <td class="usd-val">${usd.toLocaleString()} $</td>
                    <td class="profit-val">${usdWithProfit.toLocaleString()} $</td>
                    <td class="toman-val">${Math.round(finalToman).toLocaleString()} تومان</td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    // اجرا به محض لود شدن صفحه
    getTetherPrice();
    
    // آپدیت خودکار هر 60 ثانیه
    setInterval(getTetherPrice, 60000);
</script>

</body>
</html>
