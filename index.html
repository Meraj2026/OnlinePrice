<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>محاسبه‌گر حرفه‌ای پک‌های محصولی</title>
    <style>
        :root { --primary: #2563eb; --secondary: #64748b; --success: #059669; --danger: #dc2626; }
        body { font-family: Tahoma, sans-serif; background: #f1f5f9; padding: 20px; direction: rtl; color: #1e293b; }
        .container { max-width: 900px; margin: auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .header { text-align: center; margin-bottom: 25px; border-bottom: 2px solid #e2e8f0; padding-bottom: 15px; }
        .price-info { background: #eff6ff; padding: 15px; border-radius: 15px; display: flex; justify-content: space-around; align-items: center; margin-bottom: 20px; border: 1px solid #dbeaffe6; }
        .price-box { text-align: center; }
        .price-box span { display: block; font-size: 0.85rem; color: var(--secondary); }
        .price-box strong { font-size: 1.2rem; color: var(--primary); }
        .btn-group { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
        button { cursor: pointer; border: none; padding: 10px 20px; border-radius: 10px; font-family: Tahoma; transition: 0.3s; font-weight: bold; }
        .btn-auto { background: var(--primary); color: white; }
        .btn-manual { background: var(--secondary); color: white; }
        button:hover { opacity: 0.9; transform: translateY(-2px); }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; border-radius: 12px; overflow: hidden; }
        th { background: #f8fafc; color: #475569; padding: 15px; font-size: 0.85rem; border-bottom: 2px solid #e2e8f0; }
        td { padding: 12px; text-align: center; border-bottom: 1px solid #f1f5f9; font-weight: bold; font-size: 0.95rem; }
        tr:hover { background: #f8fafc; }
        .toman-cell { color: var(--danger); font-size: 1.05rem; }
        .gift-cell { color: var(--success); }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>سیستم محاسبه هوشمند پک‌ها</h2>
    </div>

    <div class="price-info">
        <div class="price-box">
            <span>قیمت لحظه‌ای بازار:</span>
            <strong id="market-price">در حال دریافت...</strong>
        </div>
        <div class="price-box">
            <span>قیمت مبنای محاسبه (با ۲.۵٪):</span>
            <strong id="calc-price" style="color:var(--danger)">---</strong>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn-auto" onclick="fetchPrice()">بروزرسانی از بازار</button>
        <button class="btn-manual" onclick="setManualPrice()">وارد کردن قیمت دستی</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>قیمت پک ($)</th>
                <th>+۱۵٪ گمرکی ($)</th>
                <th>مبلغ نهایی (تومان)</th>
                <th>هدایای محصولی ($)</th>
            </tr>
        </thead>
        <tbody id="table-body">
            </tbody>
    </table>
</div>

<script>
    // لیست پک‌ها و هدایای متناظر
    const dataList = [
        { pack: 100, gift: 0 },
        { pack: 300, gift: 115 },
        { pack: 500, gift: 230 },
        { pack: 700, gift: 460 },
        { pack: 800, gift: 460 },
        { pack: 900, gift: 460 },
        { pack: 1100, gift: 690 },
        { pack: 1500, gift: 920 },
        { pack: 2100, gift: 1150 },
        { pack: 2500, gift: 1380 },
        { pack: 2700, gift: 1380 },
        { pack: 3000, gift: 1840 },
        { pack: 3500, gift: 1840 }
    ];

    let currentBasePrice = 0;

    async function fetchPrice() {
        try {
            const res = await fetch(`https://api.tetherland.com/currencies?v=${new Date().getTime()}`);
            const data = await res.json();
            const price = parseInt(data.data.currencies.USDT.price);
            document.getElementById('market-price').innerText = price.toLocaleString() + " تومان";
            calculateAll(price);
        } catch (e) {
            alert("خطا در دریافت قیمت از بازار. لطفا قیمت را دستی وارد کنید.");
        }
    }

    function setManualPrice() {
        const val = prompt("لطفا قیمت تتر را به تومان وارد کنید:", "70000");
        if (val) {
            document.getElementById('market-price').innerText = parseInt(val).toLocaleString() + " تومان (دستی)";
            calculateAll(parseInt(val));
        }
    }

    function calculateAll(marketPrice) {
        // ۱- قیمتی که در محاسبات انجام می‌شود ۲.۵ درصد بیشتر است
        const calculationPrice = marketPrice * 1.025;
        document.getElementById('calc-price').innerText = Math.round(calculationPrice).toLocaleString() + " تومان";
        
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = '';

        dataList.forEach(item => {
            // ۲- اضافه کردن ۱۵ درصد هزینه گمرکی
            const withCustoms = item.pack * 1.15;
            // ۳- تبدیل به تومان با قیمت ۲.۵٪ بالاتر
            const finalToman = withCustoms * calculationPrice;

            tbody.innerHTML += `
                <tr>
                    <td>$${item.pack.toLocaleString()}</td>
                    <td>$${withCustoms.toLocaleString()}</td>
                    <td class="toman-cell">${Math.round(finalToman).toLocaleString()} تومان</td>
                    <td class="gift-cell">$${item.gift.toLocaleString()}</td>
                </tr>
            `;
        });
    }

    // شروع خودکار
    fetchPrice();
</script>

</body>
</html>
