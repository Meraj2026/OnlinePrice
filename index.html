<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¨Ø§ Ú†Ù‡ Ù…Ø¨Ù„ØºÛŒ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒÙ…ØŸ</title>
    <style>
        :root { --primary: #1e40af; --secondary: #64748b; --success: #059669; --danger: #be123c; --group-bg: #f1f5f9; }
        body { font-family: Tahoma, sans-serif; background: #e5e7eb; padding: 20px; direction: rtl; }
        .container { max-width: 1050px; margin: auto; background: white; padding: 30px; border-radius: 25px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); position: relative; }
        .main-title { text-align: center; color: var(--primary); margin-bottom: 25px; font-size: 1.8rem; font-weight: bold; }
        
        .price-info-banner { 
            background: linear-gradient(90deg, #1e3a8a, #3b82f6); 
            color: white; padding: 20px; border-radius: 15px; margin-bottom: 25px; 
            line-height: 1.8; text-align: center; font-size: 1.1rem;
        }
        .price-info-banner strong { color: #ffd600; font-size: 1.3rem; }

        .btn-group { text-align: center; margin-bottom: 25px; }
        button { cursor: pointer; border: none; padding: 12px 25px; border-radius: 10px; font-family: Tahoma; transition: 0.3s; font-weight: bold; margin: 0 5px; }
        .btn-auto { background: var(--success); color: white; }
        .btn-manual { background: var(--secondary); color: white; }
        .btn-calc { background: #f59e0b; color: white; } /* Ø¯Ú©Ù…Ù‡ Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨ */
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #f8fafc; color: #475569; padding: 15px; font-size: 0.85rem; border-bottom: 2px solid #e2e8f0; }
        td { padding: 12px; text-align: center; border-bottom: 1px solid #f1f5f9; font-weight: bold; }
        .category-row { background: var(--group-bg); color: var(--primary); font-weight: 800; text-align: right; padding-right: 20px; font-size: 1rem; }
        .toman-cell { color: var(--danger); }
        .gift-cell { color: var(--success); }
        .comm-cell { color: #7c3aed; }
        .small-toman { display: block; font-size: 0.75rem; opacity: 0.8; font-weight: normal; margin-top: 4px; color: #64748b; }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ù¾Ø§Ù¾ Ø¢Ù¾ Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨ */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
        .modal-content { background: white; margin: 10% auto; padding: 30px; border-radius: 20px; width: 350px; text-align: center; position: relative; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
        .close { position: absolute; left: 20px; top: 15px; font-size: 28px; cursor: pointer; color: #aaa; }
        .modal input { width: 90%; padding: 12px; margin: 15px 0; border: 2px solid #ddd; border-radius: 10px; text-align: center; font-size: 1.1rem; font-family: Tahoma; }
        .calc-res { background: #f9fafb; padding: 15px; border-radius: 10px; margin-top: 15px; border: 1px solid #eee; }
        .calc-res div { margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="main-title">Ø¨Ø§ Ú†Ù‡ Ù…Ø¨Ù„ØºÛŒ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒÙ…ØŸ</div>

    <div class="price-info-banner" id="price-banner">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø²Ø§Ø±...</div>

    <div class="btn-group">
        <button class="btn-auto" onclick="fetchPrice()">Ø¢Ù¾Ø¯ÛŒØª Ø§Ø² Ø¨Ø§Ø²Ø§Ø±</button>
        <button class="btn-manual" onclick="setManualPrice()">ÙˆØ±ÙˆØ¯ Ù‚ÛŒÙ…Øª Ø¯Ø³ØªÛŒ</button>
        <button class="btn-calc" onclick="toggleModal(true)">ğŸ–© Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨ Ø³Ø±ÛŒØ¹</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Ù‚ÛŒÙ…Øª Ù¾Ú© ($)</th>
                <th>+Û±ÛµÙª Ú¯Ù…Ø±Ú©ÛŒ ($)</th>
                <th>Ù…Ø¨Ù„Øº Ù†Ù‡Ø§ÛŒÛŒ (ØªÙˆÙ…Ø§Ù†)</th>
                <th>Ù‡Ø¯Ø§ÛŒØ§ÛŒ Ù…Ø­ØµÙˆÙ„ÛŒ ($)</th>
                <th>Ù¾ÙˆØ±Ø³Ø§Ù†Øª Ø¯Ø±ÛŒØ§ÙØªÛŒ (Ø¨Ø§ Ú©Ø³Ø± ÙˆÙˆÚ†Ø±) ($)</th>
            </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>
</div>

<div id="calcModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="toggleModal(false)">&times;</span>
        <h3 style="color: var(--primary)">Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨ Ú¯Ù…Ø±Ú©ÛŒ</h3>
        <p style="font-size: 0.8rem; color: #666;">Ù…Ø¨Ù„Øº Ø¯Ù„Ø§Ø±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</p>
        <input type="number" id="calcInput" placeholder="Ù…Ø«Ù„Ø§Ù‹ 1000" oninput="quickCalc()">
        
        <div class="calc-res">
            <div style="color: var(--secondary)">Ø¨Ø§ Û±ÛµÙª Ú¯Ù…Ø±Ú©ÛŒ: <span id="resUsd" style="color: var(--primary)">0</span> $</div>
            <div style="color: var(--danger)">Ù…Ø¹Ø§Ø¯Ù„ ØªÙˆÙ…Ø§Ù†ÛŒ:<br><span id="resToman" style="font-size: 1.3rem;">0</span> ØªÙˆÙ…Ø§Ù†</div>
        </div>
    </div>
</div>

<script>
    const groups = [
        { name: "Ø¯Ø³ØªÙ‡ Ø¨Ù†Ø¯ÛŒ Ø§ÙˆÙ„: ÛŒÚ© Ø¬Ø§ÛŒÚ¯Ø§Ù‡", items: [{p: 100, g: 0, c: 0}, {p: 300, g: 115, c: 0}, {p: 500, g: 230, c: 0}]},
        { name: "Ø¯Ø³ØªÙ‡ Ø¨Ù†Ø¯ÛŒ Ø¯ÙˆÙ…: Ø³Ù‡ Ø¬Ø§ÛŒÚ¯Ø§Ù‡", items: [{p: 700, g: 460, c: 16}, {p: 1100, g: 690, c: 48}, {p: 1500, g: 920, c: 80}]},
        { name: "Ø¯Ø³ØªÙ‡ Ø¨Ù†Ø¯ÛŒ Ø³ÙˆÙ…: Ù¾Ù†Ø¬ Ø¬Ø§ÛŒÚ¯Ø§Ù‡", items: [{p: 900, g: 460, c: 32}, {p: 1300, g: 690, c: 64}, {p: 1700, g: 920, c: 96}, {p: 2100, g: 1150, c: 128}, {p: 2500, g: 1380, c: 160}]},
        { name: "Ø¯Ø³ØªÙ‡ Ø¨Ù†Ø¯ÛŒ Ú†Ù‡Ø§Ø±Ù…: Ù‡ÙØª Ø¬Ø§ÛŒÚ¯Ø§Ù‡", items: [{p: 1900, g: 1380, c: 144}, {p: 2700, g: 1840, c: 272}, {p: 3500, g: 2300, c: 400}]}
    ];

    let globalCalcPrice = 0; // Ù‚ÛŒÙ…Øª Ù…Ø¨Ù†Ø§ Ø¨Ø±Ø§ÛŒ Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨

    async function fetchPrice() {
        try {
            const res = await fetch(`https://api.tetherland.com/currencies?v=${Date.now()}`);
            const data = await res.json();
            updateAll(parseInt(data.data.currencies.USDT.price));
        } catch (e) { alert("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª."); }
    }

    function setManualPrice() {
        const val = prompt("Ù‚ÛŒÙ…Øª ØªØªØ± (ØªÙˆÙ…Ø§Ù†):", "70000");
        if(val) updateAll(parseInt(val));
    }

    function updateAll(marketPrice) {
        globalCalcPrice = marketPrice * 1.025;
        document.getElementById('price-banner').innerHTML = `Ù‚ÛŒÙ…Øª ØªØªØ± Ø¯Ø± Ø¨Ø§Ø²Ø§Ø± Ú©Ù†ÙˆÙ†ÛŒ <strong>${marketPrice.toLocaleString()}</strong> ØªÙˆÙ…Ø§Ù† Ø§Ø³Øª Ùˆ Ù…Ø¨Ù†Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ù…Ø§ Û²,Ûµ Ø¯Ø±ØµØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ø¢Ù†Ø› ÛŒØ¹Ù†ÛŒ <strong>${Math.round(globalCalcPrice).toLocaleString()}</strong> ØªÙˆÙ…Ø§Ù†.`;
        
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = '';

        groups.forEach(group => {
            tbody.innerHTML += `<tr><td colspan="5" class="category-row">${group.name}</td></tr>`;
            group.items.forEach(item => {
                const customs = item.p * 1.15;
                const totalToman = customs * globalCalcPrice;
                const giftToman = item.g * globalCalcPrice;
                const commAfterVoucher = item.c * 0.9;
                const commToman = commAfterVoucher * globalCalcPrice;

                tbody.innerHTML += `
                    <tr>
                        <td>$${item.p.toLocaleString()}</td>
                        <td>$${customs.toLocaleString()}</td>
                        <td class="toman-cell">${Math.round(totalToman).toLocaleString()} ØªÙˆÙ…Ø§Ù†</td>
                        <td class="gift-cell">$${item.g.toLocaleString()} <span class="small-toman">(${Math.round(giftToman).toLocaleString()} Øª)</span></td>
                        <td class="comm-cell">${commAfterVoucher.toLocaleString(undefined, {minimumFractionDigits: 1})} <span class="small-toman">(${Math.round(commToman).toLocaleString()} Øª)</span></td>
                    </tr>`;
            });
        });
        quickCalc(); // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨ Ø§Ú¯Ø± Ø¨Ø§Ø² Ø¨ÙˆØ¯
    }

    // ØªÙˆØ§Ø¨Ø¹ Ù…Ø§Ø´ÛŒÙ† Ø­Ø³Ø§Ø¨
    function toggleModal(show) {
        document.getElementById('calcModal').style.display = show ? 'block' : 'none';
    }

    function quickCalc() {
        const val = document.getElementById('calcInput').value;
        if(val > 0) {
            const withCustoms = val * 1.15;
            const toman = withCustoms * globalCalcPrice;
            document.getElementById('resUsd').innerText = withCustoms.toLocaleString();
            document.getElementById('resToman').innerText = Math.round(toman).toLocaleString();
        } else {
            document.getElementById('resUsd').innerText = '0';
            document.getElementById('resToman').innerText = '0';
        }
    }

    window.onclick = function(event) {
        if (event.target == document.getElementById('calcModal')) toggleModal(false);
    }

    fetchPrice();
</script>
</body>
</html>
