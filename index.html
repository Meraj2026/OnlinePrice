<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل لحظه‌ای قیمت تتر</title>
    <style>
        :root { --primary: #2563eb; --secondary: #10b981; --dark: #1e293b; --light: #f8fafc; }
        body { font-family: 'Tahoma', sans-serif; background-color: var(--light); color: var(--dark); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .header { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); text-align: center; margin-bottom: 20px; border-top: 5px solid var(--primary); }
        .price-card { display: inline-block; background: var(--dark); color: white; padding: 10px 25px; border-radius: 50px; font-size: 1.2rem; margin-top: 10px; }
        .status { font-size: 0.9rem; margin-top: 10px; color: #64748b; }
        
        table { width: 100%; background: white; border-collapse: collapse; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        th { background-color: var(--primary); color: white; padding: 18px; font-size: 1rem; }
        td { padding: 15px; text-align: center; border-bottom: 1px solid #e2e8f0; font-weight: bold; }
        tr:hover { background-color: #f1f5f9; transition: 0.3s; }
        
        .usd-main { color: #64748b; }
        .usd-profit { color: var(--secondary); }
        .toman-final { color: #e11d48; font-size: 1.1rem; }
        
        .loading-spinner { border: 4px solid rgba(0,0,0,0.1); width: 36px; height: 36px; border-radius: 50%; border-left-color: var(--primary); animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; margin-left: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>محاسبه‌گر خودکار قیمت تتر</h1>
        <div id="loader" class="loading-spinner"></div>
        <div id="price-display" class="price-card">در حال دریافت قیمت...</div>
        <div class="status" id="last-update">آخرین بروزرسانی: --:--:--</div>
    </div>

    <table>
        <thead>
            <tr>
                <th>مبلغ ورودی (دلار)</th>
                <th>با ۱۵٪ سود (دلار)</th>
                <th>مبلغ نهایی (تومان)</th>
            </tr>
        </thead>
        <tbody id="table-body">
            </tbody>
    </table>
</div>

<script>
    const amounts = [100, 300, 500, 700, 800, 900, 1000, 1500, 2000, 2500, 3000];
    const profitFactor = 1.15;

    async function updateData() {
        const priceDisplay = document.getElementById('price-display');
        const loader = document.getElementById('loader');
        const lastUpdate = document.getElementById('last-update');

        try {
            // استفاده از API نوبیتکس از طریق یک پراکسی برای دور زدن محدودیت مرورگر
            // اگر پراکسی اول کار نکرد، از قیمت جایگزین استفاده می‌شود
            const response = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://api.nobitex.ir/v2/orderbook/USDTIRT'));
            const wrapper = await response.json();
            const data = JSON.parse(wrapper.contents);
            
            // قیمت تتر به ریال است، تبدیل به تومان
            const tetherToman = parseInt(data.lastTradePrice) / 10;

            priceDisplay.innerText = `قیمت لحظه‌ای تتر: ${tetherToman.toLocaleString()} تومان`;
            loader.style.display = 'none';
            lastUpdate.innerText = `آخرین بروزرسانی: ${new Date().toLocaleTimeString('fa-IR')}`;

            renderRows(tetherToman);

        } catch (error) {
            console.error("خطا در دریافت قیمت:", error);
            priceDisplay.innerText = "خطا در اتصال به منبع قیمت";
            priceDisplay.style.background = "#ef4444";
        }
    }

    function renderRows(tetherPrice) {
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = '';

        amounts.forEach(usd => {
            const usdWithProfit = usd * profitFactor;
            const finalToman = usdWithProfit * tetherPrice;

            const row = `
                <tr>
                    <td class="usd-main">${usd.toLocaleString()} $</td>
                    <td class="usd-profit">${usdWithProfit.toLocaleString()} $</td>
                    <td class="toman-final">${Math.round(finalToman).toLocaleString()} تومان</td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    // اجرای خودکار هنگام باز شدن صفحه
    updateData();

    // آپدیت خودکار هر 60 ثانیه یکبار بدون نیاز به رفرش
    setInterval(updateData, 60000);
</script>

</body>
</html>
