<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>محاسبه‌گر هوشمند پک و جایگاه</title>
    <style>
        :root { --primary: #1e40af; --secondary: #64748b; --success: #059669; --danger: #be123c; --group-bg: #f1f5f9; }
        body { font-family: Tahoma, sans-serif; background: #e5e7eb; padding: 20px; direction: rtl; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 25px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        .price-info { background: linear-gradient(90deg, #1e3a8a, #3b82f6); color: white; padding: 20px; border-radius: 15px; display: flex; justify-content: space-around; margin-bottom: 25px; }
        .btn-group { text-align: center; margin-bottom: 25px; }
        button { cursor: pointer; border: none; padding: 12px 25px; border-radius: 10px; font-family: Tahoma; transition: 0.3s; font-weight: bold; margin: 0 5px; }
        .btn-auto { background: var(--success); color: white; }
        .btn-manual { background: var(--secondary); color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #f8fafc; color: #475569; padding: 15px; font-size: 0.85rem; border-bottom: 2px solid #e2e8f0; }
        td { padding: 12px; text-align: center; border-bottom: 1px solid #f1f5f9; font-weight: bold; }
        .category-row { background: var(--group-bg); color: var(--primary); font-weight: 800; text-align: right; padding-right: 20px; font-size: 1rem; }
        .toman-cell { color: var(--danger); }
        .gift-cell { color: var(--success); }
        .comm-cell { color: #7c3aed; }
        .small-toman { display: block; font-size: 0.7rem; opacity: 0.7; font-weight: normal; }
    </style>
</head>
<body>

<div class="container">
    <div class="price-info">
        <div><span>قیمت بازار: </span><strong id="m-price">در حال دریافت...</strong></div>
        <div><span>مبنای محاسبات (+۲.۵٪): </span><strong id="c-price">---</strong></div>
    </div>

    <div class="btn-group">
        <button class="btn-auto" onclick="fetchPrice()">آپدیت از بازار</button>
        <button class="btn-manual" onclick="setManualPrice()">ورود قیمت دستی</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>قیمت پک ($)</th>
                <th>+۱۵٪ گمرکی ($)</th>
                <th>مبلغ نهایی (تومان)</th>
                <th>هدایای محصولی ($)</th>
                <th>پورسانت دریافتی ($)</th>
            </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>
</div>

<script>
    const groups = [
        { name: "دسته بندی اول: یک جایگاه", items: [
            {p: 100, g: 0, c: 0}, {p: 300, g: 115, c: 0}, {p: 500, g: 230, c: 0}
        ]},
        { name: "دسته بندی دوم: سه جایگاه", items: [
            {p: 700, g: 460, c: 16}, {p: 1100, g: 690, c: 48}, {p: 1500, g: 920, c: 80}
        ]},
        { name: "دسته بندی سوم: پنج جایگاه", items: [
            {p: 900, g: 460, c: 32}, {p: 1300, g: 690, c: 64}, {p: 1700, g: 920, c: 96}, {p: 2100, g: 1150, c: 128}, {p: 2500, g: 1380, c: 160}
        ]},
        { name: "دسته بندی چهارم: هفت جایگاه", items: [
            {p: 1900, g: 1380, c: 144}, {p: 2700, g: 1840, c: 272}, {p: 3500, g: 2300, c: 400}
        ]}
    ];

    async function fetchPrice() {
        try {
            const res = await fetch(`https://api.tetherland.com/currencies?v=${Date.now()}`);
            const data = await res.json();
            updateAll(parseInt(data.data.currencies.USDT.price));
        } catch (e) { alert("خطا در دریافت قیمت."); }
    }

    function setManualPrice() {
        const val = prompt("قیمت تتر (تومان):", "70000");
        if(val) updateAll(parseInt(val));
    }

    function updateAll(marketPrice) {
        const calcPrice = marketPrice * 1.025;
        document.getElementById('m-price').innerText = marketPrice.toLocaleString() + " ت";
        document.getElementById('c-price').innerText = Math.round(calcPrice).toLocaleString() + " ت";
        
        const tbody = document.getElementById('table-body');
        tbody.innerHTML = '';

        groups.forEach(group => {
            tbody.innerHTML += `<tr><td colspan="5" class="category-row">${group.name}</td></tr>`;
            group.items.forEach(item => {
                const customs = item.p * 1.15;
                const toman = customs * calcPrice;
                const commToman = item.c * calcPrice;

                tbody.innerHTML += `
                    <tr>
                        <td>$${item.p.toLocaleString()}</td>
                        <td>$${customs.toLocaleString()}</td>
                        <td class="toman-cell">${Math.round(toman).toLocaleString()} تومان</td>
                        <td class="gift-cell">$${item.g.toLocaleString()}</td>
                        <td class="comm-cell">$${item.c.toLocaleString()} <span class="small-toman">(${Math.round(commToman).toLocaleString()} ت)</span></td>
                    </tr>`;
            });
        });
    }
    fetchPrice();
</script>
</body>
</html>
