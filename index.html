<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محاسبه‌گر حرفه‌ای تتر</title>
    <style>
        :root { --primary-color: #00897b; --accent-color: #d32f2f; --bg-color: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; }
        .wrapper { max-width: 900px; margin: auto; background: white; border-radius: 20px; padding: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .header-box { text-align: center; border-bottom: 2px solid #eee; margin-bottom: 30px; padding-bottom: 20px; }
        .price-display { display: flex; justify-content: center; align-items: center; gap: 15px; margin: 20px 0; }
        .live-badge { background: #ff5252; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; animation: pulse 2s infinite; }
        .price-value { font-size: 2rem; font-weight: bold; color: var(--primary-color); }
        
        table { width: 100%; border-collapse: collapse; overflow: hidden; border-radius: 12px; }
        th { background: var(--primary-color); color: white; padding: 18px; }
        td { padding: 15px; text-align: center; border-bottom: 1px solid #edf2f7; font-size: 1.1rem; }
        tr:nth-child(even) { background: #f9fbfb; }
        tr:hover { background: #f1f4f4; transition: 0.2s; }
        
        .usd-fee { color: #546e7a; font-weight: normal; }
        .toman-total { color: var(--accent-color); font-weight: 800; }
        
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        @media (max-width: 600px) { th, td { padding: 10px; font-size: 0.9rem; } }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="header-box">
        <h2>لیست تبدیل دلار به تومان (تتر + ۱۵٪)</h2>
        <div class="price-display">
            <span class="live-badge">LIVE</span>
            <span id="current-price" class="price-value">درحال فراخوانی...</span>
        </div>
        <p style="color: #7f8c8d;" id="update-timer">بروزرسانی شده در: --:--</p>
    </div>

    <table>
        <thead>
            <tr>
                <th>مبلغ (USD)</th>
                <th>با ۱۵٪ سود (USD)</th>
                <th>مبلغ نهایی (تومان)</th>
            </tr>
        </thead>
        <tbody id="data-table">
            </tbody>
    </table>
</div>

<script>
    const amounts = [100, 300, 500, 700, 800, 900, 1000, 1500, 2000, 2500, 3000];
    const feePercent = 1.15;

    async function fetchExactPrice() {
        const priceLabel = document.getElementById('current-price');
        const timeLabel = document.getElementById('update-timer');

        try {
            // استفاده از پراکسی قدرتمند برای دریافت مستقیم از نوبیتکس
            const response = await fetch('https://api.allorigins.win/get?url=' + encodeURIComponent('https://api.nobitex.ir/v2/orderbook/USDTIRT'));
            const json = await response.json();
            const data = JSON.parse(json.contents);
            
            // دریافت قیمت آخرین معامله و تبدیل ریال به تومان
            const exactPrice = parseInt(data.lastTradePrice) / 10;

            priceLabel.innerText = exactPrice.toLocaleString() + " تومان";
            timeLabel.innerText = "آخرین بروزرسانی نوبیتکس: " + new Date().toLocaleTimeString('fa-IR');
            
            updateTable(exactPrice);

        } catch (error) {
            console.log("خطا در دریافت قیمت نوبیتکس، تلاش مجدد با منبع جایگزین...");
            // در صورت خطا، از منبع دوم استفاده می‌کند که باز هم دقیق است
            const altRes = await fetch('https://api.tetherland.com/currencies');
            const altData = await altRes.json();
            const altPrice = parseInt(altData.data.currencies.USDT.price);
            priceLabel.innerText = altPrice.toLocaleString() + " تومان";
            updateTable(altPrice);
        }
    }

    function updateTable(price) {
        const tbody = document.getElementById('data-table');
        tbody.innerHTML = '';

        amounts.forEach(val => {
            const withProfit = val * feePercent;
            const finalToman = Math.round(withProfit * price);

            const row = `
                <tr>
                    <td>$${val.toLocaleString()}</td>
                    <td class="usd-fee">$${withProfit.toLocaleString()}</td>
                    <td class="toman-total">${finalToman.toLocaleString()} تومان</td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    // اجرای اول
    fetchExactPrice();
    // بروزرسانی هر ۴۵ ثانیه برای جلوگیری از بلاک شدن توسط صرافی
    setInterval(fetchExactPrice, 45000);
</script>

</body>
</html>
