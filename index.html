<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>محاسبه‌گر نهایی تتر (بدون خطا)</title>
    <style>
        body { font-family: Tahoma, sans-serif; background-color: #f0f2f5; padding: 20px; direction: rtl; }
        .card { max-width: 600px; margin: auto; background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .price-tag { font-size: 24px; color: #2e7d32; font-weight: bold; text-align: center; margin: 20px 0; padding: 10px; background: #e8f5e9; border-radius: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #1565c0; color: white; padding: 12px; font-size: 14px; }
        td { padding: 12px; text-align: center; border-bottom: 1px solid #ddd; font-weight: bold; }
        .error { color: #c62828; text-align: center; font-weight: bold; }
        .loading { text-align: center; color: #666; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="card">
    <h2 style="text-align:center;">تبدیل دلار به تومان (+۱۵٪)</h2>
    <div id="status" class="loading">در حال برقراری ارتباط با بازار...</div>
    <div id="price-box" class="price-tag" style="display:none;"></div>

    <table id="main-table" style="display:none;">
        <thead>
            <tr>
                <th>دلار اصلی</th>
                <th>با ۱۵٪ سود</th>
                <th>تومان نهایی</th>
            </tr>
        </thead>
        <tbody id="rows"></tbody>
    </table>
</div>

<script>
    const amounts = [100, 300, 500, 700, 800, 900, 1000, 1500, 2000, 2500, 3000];
    
    async function getPrice() {
        const statusDiv = document.getElementById('status');
        const priceBox = document.getElementById('price-box');
        const table = document.getElementById('main-table');

        // لیست منابع قیمت (اگر اولی کار نکرد، دومی را چک می‌کند)
        const sources = [
            'https://api.tetherland.com/currencies',
            'https://api.nobitex.ir/v2/orderbook/USDTIRT'
        ];

        for (let url of sources) {
            try {
                // استفاده از یک متد ساده‌تر برای دور زدن محدودیت‌ها
                const response = await fetch(url);
                const data = await response.json();
                
                let price;
                if (url.includes('tetherland')) {
                    price = parseInt(data.data.currencies.USDT.price);
                } else {
                    price = parseInt(data.lastTradePrice) / 10;
                }

                if (price > 1000) {
                    showData(price);
                    return; // اگر قیمت را گرفت، از حلقه خارج شو
                }
            } catch (e) {
                console.log("تلاش با منبع بعدی...");
            }
        }

        // اگر هیچ‌کدام کار نکرد (به دلیل محدودیت مرورگر محلی)
        statusDiv.innerHTML = `<div class="error">خطای امنیتی مرورگر! <br> برای لود شدن قیمت، لطفا روی دکمه زیر کلیک کنید:</div>
        <button onclick="window.location.reload()" style="margin-top:10px; padding:10px; cursor:pointer;">تلاش مجدد</button>
        <p style="font-size:12px; color:gray;">نکته: اگر فایل را مستقیم از کامپیوتر باز می‌کنید، مرورگر اجازه دریافت قیمت را نمی‌دهد. راه حل: فیلترشکن را خاموش یا روشن کنید.</p>`;
    }

    function showData(price) {
        document.getElementById('status').style.display = 'none';
        const priceBox = document.getElementById('price-box');
        const table = document.getElementById('main-table');
        const rows = document.getElementById('rows');

        priceBox.innerText = `قیمت تتر: ${price.toLocaleString()} تومان`;
        priceBox.style.display = 'block';
        table.style.display = 'table';

        rows.innerHTML = '';
        amounts.forEach(amt => {
            const withFee = amt * 1.15;
            const toman = Math.round(withFee * price);
            rows.innerHTML += `<tr>
                <td>$${amt.toLocaleString()}</td>
                <td style="color:#1565c0">$${withFee.toLocaleString()}</td>
                <td style="color:#c62828">${toman.toLocaleString()} تومان</td>
            </tr>`;
        });
    }

    getPrice();
</script>

</body>
</html>
